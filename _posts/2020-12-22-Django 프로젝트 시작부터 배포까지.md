---
layout: post
title:  "Django 프로젝트 시작부터 배포까지"
date:   2020-12-23
categories: ["2020","develop"]
update: 2020-12-23
tags: [develop,django,aws]
---


시험기간이 끝나서 드디어 해보고 싶었던 개발 공부를 할 시간이 생겼습니다.😃 노노그램(=네모네모로직) 게임을 좋아해서 노노그램을 풀어주는 스크립트를 짜고, 서비스에 올려 배포까지 해야겠다는 계획을 세웠습니다. 그리고 이번 기회에 AWS를 이용해서 서버를 제대로 구축해놓고 개발을 하나씩 할 때마다 이 서버에 올릴 예정입니다.

평소 `Python`을 많이 사용해서 파이썬 웹 프레임워크 중 **Flask**를 선택할지 **Django**를 선택할 지 결정해야 했습니다. 제가 이번 프로젝트에 **Django**를 선택하게 된 과정을 설명해보겠습니다.

### 👀 Django vs Flask

Flask는 한 프로젝트 당 1개의 어플리케이션을 개발하도록 설계되었습니다. 반면 Django는 한 프로젝트에 여러 어플리케이션을 개발할 수 있습니다. 추후에 여러 어플리케이션들을 이 서비스에 올리려고 계획 중이었기 때문에 Django가 낫다고 생각했습니다.

그리고 DB 접근에도 차이가 있습니다. `ORM`이 뭔지 알고 계신가요?

> #### 객체 관계 맵핑 (Object Relational Mapping, ORM)
>
> 객체 관계 맵핑(ORM)은 데이터베이스와 객체 지향 프로그래밍 언어 간의 호환되지 않는 데이터를 변환하는 프로그래밍 기법이다.

즉 저희가 사용하는 언어(Python)에서 '가상' 객체 데이터베이스를 구축하는 프로그래밍 방법입니다. Django는 강력한 ORM을 제공하지만 Flask는 ORM이 따로 없기 때문에 다른 DB 툴킷을 사용해야 합니다. 

이런 이유와 더불어 빨리 개발하고 배포하고 싶은 마음에 Django를 선택하게 되었습니다.

## 📃 Note

Django 프로젝트의 시작부터 끝까지 친절히 설명하는 글을 쓰려고 했는데 정말정말정말 친절하고 누구나 다 알아볼 수 있게 쓰인 글이 있어(이 분보다 잘 쓸 자신이 없음...) 링크 남기고 저는 프로젝트를 진행하는 흐름을 정리하고 느낀 점과 배운 점 그리고 개념적인 부분만 주로 남기려고 합니다. 배포를 하는 과정도 친절하게 설명해주셔서 AWS EC2를 이용해 배포를 할 때 Django를 이용하지 않더라도 참고하면 좋을 것 같습니다.  

>🚀  [[Django Tutorial] Blog 만들기 - 1. 환경설정](https://nachwon.github.io/django-1-setting/)
>
>🚀  [[Deploy] Django 프로젝트 배포하기 - 1. AWS](https://nachwon.github.io/django-deploy-1-aws/)

목차대로 차근차근 따라가시면 충분히 진행할 수 있으실 겁니다.

### App

위에서 Django는 한 프로젝트에 여러 어플리케이션을 개발할 수 있다고 했습니다. 각각의 어플리케이션(앱)들은 독자적인 `모델(Model)`, `템플릿(Template)`, `뷰(View)`로 구성됩니다. 저는 이 프로젝트에서 노노그램을 풀어주는  어플리케이션, 블랙보드 공지사항을 크롤링해주는 어플리케이션 등을 만들 계획입니다. 

### MVC 패턴

어플리케이션이 `모델(Model)`, `뷰(View)`, `컨트롤러(Controller)` 로 구성되도록 개발하는 방법을 `MVC 패턴`이라고 합니다. `MVC 패턴`은 웹 어플리케이션 개발에서 주로 사용하는 디자인 패턴입니다. 각각의 요소가 의미하는 것은 다음과 같습니다 :

- **모델** : 어플리케이션의 정보, 데이터 즉 데이터베이스, 상수, 변수 등을 의미합니다. 그리고 이런 데이터들을 가공하는 컴포넌트를 의미합니다.
- **뷰** : 모델로부터 제공된 데이터를 반영하여 사용자에게 보여주게 되는 부분입니다.
- **컨트롤러** : 사용자의 요청을 모델에게 전달하고, 업데이트를 뷰에 반영하여 사용자에게 제공합니다.

사용자와 `MVC`패턴 과의 상호작용은 다음 그림으로 나타낼 수 있습니다.

![](https://nachwon.github.io/img/django_tutorial/MVC.png)

사용자가 **컨트롤러**를 조작해 **컨트롤러**가 **모델**로 부터 데이터를 가져오고 그 데이터를 **뷰**에 반영하여 사용자가 보게 됩니다. 

Django에서는 **뷰**의 역할을 `템플릿(Template)`이, **컨트롤러**의 역할을 `뷰(View)`가 해서 **MTV 패턴**이라고 불리기도 합니다.

이렇게 역할분담을 통해 나눠서 개발하면 개발하기도 쉽고 유지보수도 편해집니다.

### 전체적인 흐름

위에서 준 링크에서 가르쳐주는대로 따라가보면 쉽게 알 수 있겠지만 이번 프로젝트를 하면서 정리한 전체적인 흐름을 설명하려고 합니다. 각각의 방법들은 생략하겠습니다.

#### 앱 만들기

Django 프로젝트는 여러 개의 어플리케이션으로 이루어진다고 했습니다. 그러니까 제일 먼저 어플리케이션, 즉 앱을 만들어 줘야겠네요.

#### 모델 생성

Django 프로젝트의 각각의 어플리케이션들은 `MVC 패턴`으로 개발된다고 했습니다. 이 어플리케이션에서 사용할 데이터들을 모델에 정의해주면 됩니다. DB에서 테이블을 만드는 과정과 비슷합니다.

#### 마이그레이션

Migration은 Django의 모델에서 설명하고 있는 테이블구조를 데이터베이스에 적용시키기 위해, 기록을 남기는 과정입니다. 앱에서 필요한 DB 구조를 기록한 파일이 `Migrations` 파일이고, 이를 데이터베이스에 적용하는 과정을 `migrate`한다고 합니다. 이 과정을 통해 모델에서 정의한 구조가 데이터베이스에 반영됩니다. 이 데이터베이스는 Django에서 default로 제공하는 관리자 페이지에서 관리할 수 있습니다.

#### 뷰 만들기

`MVC 패턴`의 컨트롤러 역할을 Django에서는 **뷰**가 할 수 있습니다. 컨트롤러는 사용자의 요청에 따라 모델을 조작하고 업데이트를 뷰에 적용한다고 했습니다. 즉 Django의 **뷰**는 사용자의 요청(request)에 따라 적절한 결과값(response)을 돌려보내 주는 요소가 되겠네요. 

#### 템플릿 만들기

`MVC 패턴`의 뷰에 해당하는 **템플릿(Template)**는 결과값을 그럴싸하게 꾸며주기 위해 사용합니다. html 파일과 템플릿 언어를 이용하여 데이터베이스의 데이터를 적용하여 동적으로 템플릿을 생성합니다. 그리고 스태틱 파일(css,js) 등을 이용하여 페이지를 꾸밉니다.



정리하자면, 사용자는 `템플릿`을 통해 `모델`의 데이터를 볼 수 있고 사용자가 그 데이터를 조작하기 위해 중간에 `뷰`가 사용됩니다. 이렇게 하면 로컬에서 Django 서버를 올리는데는 성공했습니다. 이제 배포를 해야 합니다.

### 🔨 AWS를 이용한 배포

Django에서는 `runserver`를 이용해 개발용 서버를 운영할 수 있는 기능을 제공합니다. 실제 서비스를 운영할 때는 웹서버를 따로 사용해야 합니다. 이 프로젝트에서는 `Nginx` 웹 서버를 이용하고 Django와 `Nginx`를 연결해주기 위해 `WSGI`를 사용합니다.

`WSGI` 는 Django와 웹서버를 연결해주는 Python 프레임워크입니다. 사용자가 웹서버에 요청을 보내면 요청을 WSGI Server가 처리하여 Django에게 넘겨줍니다. 그리고 Django가 처리한 응답을 WSGI Server가 받아 웹서버에 전달합니다. 이번 프로젝트에서는 WSGI 서버 중 하나인 `uWSGI`를 사용하였습니다.

`uWSGI`는 `.ini`파일을 통해 관리가 가능합니다. `uwsgi`를 실행하면 사용자의 요청을 Django로 전달할 수 있기 때문에 `runserver`를 하지 않아도 됩니다.

이제 웹서버 `Nginx`를 `uWSGI`와 연결해주면 모든 세팅이 끝납니다. 그리고 AWS에서 제공한 EC2 인스턴스에 `Nginx`와 `uWSGI`를 서비스로 등록하면, EC2 인스턴스가 살아있는 동안 서버가 계속 돌아갈 수 있습니다. 그러면 로컬에서만 접속되었던 서버가, AWS에서 제공하는 도메인으로 접속할 수 있게 됩니다.



## 📗 TODO

지금까지는 Django 어플리케이션을 이용해 프론트(template)와 백을 둘 다 구성했습니다. 이제는 프론트에 React를 연결해서 최종적으로 프론트와 백을 완성하려고 합니다. 그리고 현재 10x10까지만 풀어낼 수 있는 노노그램 솔버를 개선하고(목표는 20x20) Visualization까지 해야 합니다. 해야 할 일을 정리해보면

- React(+Redux)로 프론트 재구성
- 솔버 기능 개선
- 입력을 solver가 사용할 수 있게끔 전처리

정도가 있겠네요. 이번 기회에 제대로 구성해놓고 다음에도 만들고 싶은 어플리케이션이 있으면 계속 올릴 수 있게   잘 만들어 놔야겠습니다. 방학이지만 더 바빠진 건 왜인지 .. 🤣