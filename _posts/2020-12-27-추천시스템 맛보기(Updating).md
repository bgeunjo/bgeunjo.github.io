---

layout: post
title:  "추천 시스템 맛보기(Updating)"
date:   2020-12-27
categories: ["2020","AI"]
update: 2020-12-27
tags: [AI,Recommendation]
---



저 번에 쓴 **Preliminary of Recommendation**에서 추천 시스템에 대한 개요와 협업 필터링 방식에 대해 간단히 설명했었습니다. 이 번에는 추천 시스템을 입문하기 위해 데이터셋을 불러오고 그 데이터셋에 대해 테스트해볼까 합니다. 

이 글은 fast campus 이재원 강사님의 '딥러닝을 활용한 추천시트템 구현 올인원 패키지 Online'의 내용 중 일부입니다.

### 데이터셋 불러오기

Movielens 데이터셋을 사용할 건데 **MovieLens Latest Datasets** 중 Small 데이터 셋을 사용하겠습니다.

[이 링크](https://grouplens.org/datasets/movielens/)에 가시면 다운로드하실 수 있습니다.

다운로드 받으시면 여러 csv파일이 있는데 그 중 주로 보게 되는 파일이 `ratings.csv`입니다. 추천 시스템에서 풀고자 하는 문제는 사용자가 아이템에 대해 어떤 rating을 남길 지 예측하는 것이기 때문입니다.  `pandas`모듈의 `read_csv()`를 통해 csv 파일을 DataFrame으로 읽어오면 됩니다.

``` python
import pandas as pd
ratings_df = pd.read_csv(os.path.join(path, 'ratings.csv'), encoding='utf-8')
movies_df = pd.read_csv(os.path.join(path, 'movies.csv'), index_col='movieId', encoding='utf-8')
tags_df = pd.read_csv(os.path.join(path, 'tags.csv'), encoding='utf-8')
```

`ratings_df`의 내용을 보면 `userId`, `movieId`, `rating`이 주 컨텐츠입니다.

![image](https://user-images.githubusercontent.com/51329156/103155936-470d3f00-47e7-11eb-971a-d40df6d24907.png)

### 데이터셋을 학습셋과 평가셋으로 나누기

`sklearn`에서 데이터셋을 학습셋과 평가셋으로 나누는 기능을 지원합니다.

``` python
from sklearn.model_selection import train_test_split
train_df, test_df = train_test_split(ratings_df, test_size=0.2, random_state=1234)
```

이 셋을 이용해 간단히 랜덤으로 평점을 예측하는 말도 안 되는 추천을 한 번 해봅시다.

### 랜덤으로 평점 예측 해보기

평점의 경우의 수는 0.5 , 1.0 , 1.5 , ..., 5 입니다. 이를 만들 때 `numpy`를 사용하면 됩니다.

``` `python
import numpy as np
ratings_range = np.arange(0.5, 5.5, step=0.5)
```

`np.arange()`는 시작점과 끝점, 그리고 늘어나는 정도를 주면 자동으로 그 사이의 모든 값으로 이루어진 배열을 만들어 줍니다.

이제 이 값들을 랜덤으로 선택해서 실제 rating값과 비교해야겠네요. 랜덤으로 선택된 값으로 이루어진 리스트를 만들어줍니다.

``` python
import random
pred_random = [random.choice(ratings_range) for _ in range(len(test_df))]
```

그리고 이렇게 만든 리스트를 테스트 셋의 컬럼으로 붙여줍니다,

```python
test_df['pred_ratings_random'] = pred_random
```

이제 `test_df`에는 실제 rating과 랜덤으로 선택된 rating값이 한 행에 같이 존재합니다. 이 값들을 이용해 추천 시스템을 평가할 때 사용할 수 있는 지표 중 **RMSE**를 사용하겠습니다. **RMSE**에 대해서는 이전 글에서 언급했으니 간단히만 설명하면 평균 제곱근 편차, 즉 편차의 평균을 제곱근한 값입니다. **MSE**, 즉 평균 제곱 오차를 구해주는 기능이 `sklearn`에 있기 때문에 사용해서 구해봅시다.

``` python
from sklearn.metrics import mean_squared_error

mse = mean_squeare_error(y_true=test_df['rating'].values, y_pred=test_df['pred_ratings_random'].values)
rmse = np.sqrt(mse)
print(mse, rmse)
```

```
3.6989289964299883 1.9232599918965685
```

**RMSE**값이 약 1.9로 상당히 높은 것을 알 수 있습니다. **RMSE**가 1.9라는 의미는 실제 rating은 3이지만 예측값은 1.1 혹은 4.9라는 말입니다. 거의 못 맞춘다고 보면 되겠네요. 이제 랜덤으로 추천하는 경우가 말이 안 된다는 것을 직접 경험해봤으니 그나마 나은 것을 선택해서 연습해봅시다.





