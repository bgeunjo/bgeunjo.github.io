---
layout: post
title:  "Web cache poisoning"
date:   2020-10-14
categories: ["2020","web hacking"]
update:   2020-10-14
comment: true
tags: [web]
---

# Web cache poisoning

ë¬¸ì œ í’€ë©´ì„œ ì²˜ìŒ ì ‘í•œ ê°œë…ì¸ë° í•œê¸€ë¡œ ì •ë¦¬ëœ ê¸€ì´ ë³„ë¡œ ì—†ëŠ” ê²ƒ ê°™ì•„ Portswiggerì˜ ê¸€ì„ ì •ë¦¬í•´ë´¤ë‹¤.

> ğŸš€ [https://portswigger.net/web-security/web-cache-poisoning](https://portswigger.net/web-security/web-cache-poisoning)

## What is web cache poisoning?

**Web cache poisoning** ê³µê²©ì€ ì›¹ ì„œë²„ì™€ ìºì‰¬ì˜ ë™ì‘ì„ ì¡°ì‘í•˜ì—¬ ìœ„í—˜í•œ HTTP ì‘ë‹µì„ ë‹¤ë¥¸ ìœ ì €ì—ê²Œ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ê³µê²© ë°©ë²•ì´ë‹¤.

**Web cache poisoning** ê³µê²©ì€ ë‘ ë‹¨ê³„ë¡œ ì§„í–‰ëœë‹¤.

1. ë°±ì—”ë“œ ì„œë²„ë¡œë¶€í„° ìœ„í—˜í•œ í˜ì´ë¡œë“œë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ì‘ë‹µì„ ìœ ë„í•´ë‚¼ ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.
2. 1ë‹¨ê³„ê°€ ì„±ê³µí•˜ë©´, ê·¸ ì‘ë‹µì´ **cached**ë˜ê³  í›„ì— ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤.

ì´ ê³µê²©ì´ ì„±ê³µí•˜ë©´ XSS, Javascript injection, open redirection ë“±ì˜ ê³µê²©ì„ ì„±ê³µì‹œí‚¬ ìˆ˜ë„ ìˆë‹¤.

### How does a web cache work?

**web cache**ê°€ ë™ì‘í•˜ëŠ” ë°©ì‹ì„ ì´í•´í•´ë³´ì.

ì„œë²„ê°€ ë§¤ HTTP ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ ì‘ë‹µì„ ë³´ë‚´ì•¼ í•œë‹¤ë©´, ì„œë²„ì— ê³¼ë¶€í™”ì™€ ì§€ì—°ì„ ì¼ìœ¼í‚¤ê³  ì‚¬ìš©ìì˜ í¸ì˜ë„ ë–¨ì–´ì§„ë‹¤. **web cache**ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ì´ë‹¤.

**web cache**ëŠ” ì‚¬ìš©ìì™€ ì„œë²„ ì‚¬ì´ì—ì„œ íŠ¹ì • ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ì¼ì • ê¸°ê°„ë™ì•ˆ ì €ì¥í•œë‹¤. í›„ì— ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë˜‘ê°™ì€ ìš”ì²­ì„ ë³´ë‚´ë©´, ë°±ì—”ë“œì™€ interaction ì—†ì´ **cache**ì— ì €ì¥ëœ ì‘ë‹µì˜ ë³µì‚¬ë³¸ì„ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•œë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì¤‘ë³µë˜ëŠ” ì—¬ëŸ¬ ìš”ì²­ì„ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

![](https://portswigger.net/web-security/images/caching.svg)

#### Cache keys

ìºì‰¬ê°€ HTTP ìš”ì²­ì„ ë°›ìœ¼ë©´, ìºì‰¬ì— ì €ì¥ëœ ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ì‘ë‹µì´ ìˆëŠ”ì§€ ë³´ê³ , ì•„ë‹ˆë©´ ìš”ì²­ì„ ë°±ì—”ë“œì„œë²„ë¡œ í¬ì›Œë”©í•œë‹¤. ìºì‰¬ëŠ” ìš”ì²­ì—ì„œ ë¯¸ë¦¬ ì •ì˜ëœ ë¶€ë¶„(**cache key**)ì„  ì´ìš©í•´ ê°™ì€ ìš”ì²­ì¸ì§€ ì•„ë‹Œì§€ êµ¬ë¶„í•œë‹¤.  ì£¼ë¡œ request lineê³¼ `Host` í—¤ë”ë¥¼ í¬í•¨í•œë‹¤. ìš”ì²­ ì¤‘ì— cache keyì— í¬í•¨ë˜ì§€ ì•Šì€ ë¶€ë¶„ì€ **unkeyed**ë¼ê³  ë¶€ë¥¸ë‹¤.

ìƒˆë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì˜ cache keyê°€ ì´ì „ ìš”ì²­ì˜ keyì™€ ê°™ìœ¼ë©´,  ìºì‰¬ëŠ” ë‘ ìš”ì²­ì´ ê°™ë‹¤ê³  ì—¬ê¸´ë‹¤. ê·¸ë˜ì„œ ìºì‰¬ì— ì €ì¥ëœ ì‘ë‹µì„ ë³µì‚¬í•´ì„œ ì „ë‹¬í•œë‹¤. ìš”ì²­ì˜ ë‹¤ë¥¸ ë¶€ë¶„ì€ ë¬´ì‹œëœë‹¤.

## Constructing a web cache poisoning attack

ê¸°ë³¸ì ì¸ **web cache poisoning** ê³µê²©ì€ ë‹¤ìŒ ë‹¨ê³„ë“¤ì„ í¬í•¨í•œë‹¤:

1. **unkeyed input** í™•ì¸
2. ë°±ì—”ë“œ ì„œë²„ë¡œë¶€í„° ì›í•˜ëŠ” ì‘ë‹µ ìœ ë„
3. ìºì‰¬ëœ ì‘ë‹µ íšë“

### Identify and evaluate unkeyed inputs

ëª¨ë“  **web cache poisoning** ê³µê²©ì€ unkeyed input(such as headers)ì„ ì–´ë–»ê²Œ ì¡°ì‘í•˜ëŠ”ì§€ì— ë‹¬ë ¸ë‹¤. ìºì‰¬ëœ ì‘ë‹µì„ ì „ë‹¬í• ì§€ ê²°ì •í•  ë•Œ unkeyed inputì€ ë¬´ì‹œí•œë‹¤. ì´ ë§ì€, í˜ì´ë¡œë“œë¥¼ ì‚½ì…í•´ì„œ ê°™ì€ cache keyë¥¼ ê°€ì§„ ìš”ì²­ì—ê²Œ **poisoned** ì‘ë‹µì„ ìœ ë„í•  ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.

ì‘ë‹µì— ëœë¤í•œ ì…ë ¥ê°’ì„ ë„£ì–´ë³´ë©´ì„œ ì‘ë‹µì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ì§€ ì•ˆ ë¯¸ì¹˜ëŠ”ì§€ í™•ì¸í•˜ë©´ì„œ unkeyed inputsë¥¼ ì‹ë³„í•  ìˆ˜ ìˆë‹¤. **Burp Comparer**ì„ ì´ìš©í•˜ë©´ ë‘ ì‘ë‹µê°„ì— ì°¨ì´ì ì„ í™•ì¸í•  ìˆ˜ ìˆì§€ë§Œ, ë„ˆë¬´ ë§ì€ ì‘ì—…ì„ í•„ìš”ë¡œ í•œë‹¤.

#### Param Miner

**Burp**ì˜ [Param Miner](https://portswigger.net/bappstore/17d2949a985c4b7ca092728dba871943) í™•ì¥ í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•´ì„œ unkeyed inputì„ ì‹ë³„í•˜ëŠ” ê³¼ì •ì„ ìë™í™”í•  ìˆ˜ ìˆë‹¤.

- ë‹¤ìš´ë°›ê³  ìš”ì²­ ìš°í´ë¦­ âœ **Guess headers** í´ë¦­

ë§Œì•½ ì…ë ¥ì— ë”°ë¥¸ ì°¨ì´ê°€ ì‘ë‹µì— ë‚˜íƒ€ë‚˜ë©´, ë¡œê·¸ë¥¼ ë‚¨ê¸´ë‹¤.

Ex)

![](https://portswigger.net/web-security/images/param-miner.png)

**ì£¼ì˜** : ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì‚¬ìš©í•  ë•ŒëŠ” **cache buster**ë¥¼ ì¼œì„œ ì‹¤ì œ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šë„ë¡ í•˜ì.

### Elicit a harmful response from the back-end server

unkeyed inputì„ ì°¾ì•˜ìœ¼ë©´, ì›¹ì‚¬ì´íŠ¸ê°€ ì–´ë–»ê²Œ ê·¸ inputì„ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. ì´ ê³¼ì •ì´ ì œì¼ ì¤‘ìš”í•˜ë‹¤. ì´ inputì´ í•„í„°ë§ì—†ì´ ì‘ë‹µì— í¬í•¨ë˜ê±°ë‚˜, ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ë§Œë“œëŠ”ë° ì‚¬ìš©ëœë‹¤ë©´, **web cache poisoning**ì˜ ì ì¬ì ì¸ entry pointë‹¤.

#### Get the response cached

ì˜ë„í•œ ì‘ë‹µì„ ì´ëŒì–´ë‚´ê¸° ìœ„í•´ inputì„ ì¡°ì‘í•˜ëŠ” ê²ƒì€ ê³µê²©ì˜ ê±°ì˜ ì ˆë°˜ì„ ì°¨ì§€í•˜ì§€ë§Œ, ë§Œì•½ ì‘ë‹µì„ ìºì‰¬ì— ì €ì¥í•  ìˆ˜ ì—†ìœ¼ë©´ ë”±íˆ ë„ì›€ì´ ì•ˆë  ìˆ˜ë„ ìˆë‹¤.

ìºì‰¬ë˜ëŠ”ì§€ ì•ˆë˜ëŠ”ì§€ëŠ” file extension, content type, route, status code ê·¸ë¦¬ê³  ì‘ë‹µ í—¤ë” ì˜í–¥ì²˜ëŸ¼ ëª¨ë“  ìš”ì†Œì— ì˜í–¥ì„ ë°›ëŠ”ë‹¤. ê·¸ë˜ì„œ ë‹¤ë¥¸ í˜ì´ì§€ë“¤ì—ì„œ ì—¬ëŸ¬ ìš”ì²­ë“¤ì„ ë³´ë‚´ë³´ê³ , cacheê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë´ì•¼ í•œë‹¤. ì•…ì„± inputì„ í¬í•¨í•˜ê³  ìˆëŠ” ì‘ë‹µì„ ìºì‰¬ì— ì €ì¥í•  ìˆ˜ë§Œ ìˆìœ¼ë©´, ê³µê²©ì„ ìˆ˜í–‰í•  ì¤€ë¹„ê°€ ëë‚œ ê²ƒì´ë‹¤.

![](https://portswigger.net/web-security/images/cache-poisoning.svg)

## Exploiting web cache poisoning vulnerabilities

> ğŸš€ [Exploiting cache design flaws](https://portswigger.net/web-security/web-cache-poisoning/exploiting-design-flaws)
>
> ğŸš€ [Exploiting cache implementation flaws](https://portswigger.net/web-security/web-cache-poisoning/exploiting-implementation-flaws)

ìœ„ ë‘ í˜ì´ì§€ì— ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì—°ìŠµí• ë§Œí•œ Labë“¤ì´ ìˆë‹¤.