---
layout: post
title:  "ì´ìƒ íƒì§€ - Isolation Forest"
date:   2021-03-23
categories: ["2021","AI"]
update:   2021-03-23
use_math: true
comment: true
---

ì •ë§ ì˜¤ëžœë§Œì— ê¸€ì´ë„¤ìš”.ðŸ¤£ ìµœê·¼ ì§ìž¥ì„ ë‹¤ë‹ˆê²Œ ë˜ë©´ì„œ ìƒˆë¡œìš´ ê³µë¶€ë“¤ì„ ë§Žì´ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.. ì§€ê¸ˆ í•˜ê³  ìžˆëŠ” ì—…ë¬´ì˜ ìµœì¢… ëª©í‘œëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ í–‰ì‚¬ì•ˆì„ ì œì‹œí•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì§€ê¸ˆ ë‹¨ê³„ì—ì„œëŠ” ë§¤ì¶œ ì˜ˆì¸¡ì„ ì‹œë„í•˜ê³  ìžˆëŠ”ë°ìš”,  **EDA - Feature Engineering - Modeling** ì‚¬ì´í´ì„ ì—¬ëŸ¬ë²ˆ ëŒë¦¬ë‹¤ ë³´ë‹ˆ ë°ì´í„°ì—ì„œ ì´ìƒí•œ ì ì„ ê³„ì†í•´ì„œ ë°œê²¬í•˜ê²Œ ë©ë‹ˆë‹¤.

ì´ë•Œê¹Œì§€ëŠ” ì£¼ë¨¹êµ¬êµ¬ì‹ìœ¼ë¡œ ê¸°ì¤€ì„ ìž¡ê³  ë¹„ì •ìƒ ë°ì´í„°ë¥¼ ì œì™¸í•´ì™”ëŠ”ë°, ì›”ìš”ì¼ íšŒì˜ ë•Œ ëŒ€í‘œë‹˜ê»˜ 'ê·¼ê±°'ë¥¼ ì œì‹œí•˜ë¼ëŠ” ë§ì”€ì„ ë“£ê³  ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¾ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëž˜ì„œ **ì´ìƒ íƒì§€(Anomarly Detection)**ì— ëŒ€í•´ ê³µë¶€ë¥¼ ì‹œìž‘í–ˆê³  **Isolation Forest**ë¼ëŠ” ì´ìƒíƒì§€ ê¸°ë²•ì„ ì‚¬ìš©í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

# ì´ìƒ íƒì§€(Anomarly Detection)



## Introduction

>**ì´ìƒ íƒì§€**ëž€ íŠ¹ì • ë„ë©”ì¸ì—ì„œ ì¼ë°˜ì ì¸ íŠ¹ì„±ì„ ë”°ë¥´ì§€ ì•ŠëŠ” ë°ì´í„°ë‚˜, ì •ìƒ(normal)ìœ¼ë¡œ ê·œì •ëœ ë°ì´í„°ì™€ ë‹¤ë¥¸ íŠ¹ì§•ì„ ê°€ì§€ëŠ” ë°ì´í„°ë¥¼ ì°¾ì•„ë‚´ëŠ” ê²ƒì„ ë§í•©ë‹ˆë‹¤. ì´ìƒ íƒì§€ ê¸°ë²•ì„ ì¨ì„œ ì°¾ì•„ë‚´ëŠ” ë°ì´í„°ëŠ” ë¶ˆëŸ‰, ì˜¤ë¥˜, ì•…ì„±ì½”ë“œ, ê°€ì§œ ë°ì´í„°ì¼ ìˆ˜ë„ ìžˆê³ , ì˜ˆì™¸, ë…¸ì´ì¦ˆ, ìƒˆë¡œìš´ íŒ¨í„´ ë“±ì˜ ë°ì´í„°ì¼ ìˆ˜ë„ ìžˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ëŸ° ë°ì´í„°ë“¤ì„ outliers í˜¹ì€ anomaliesë¼ê³  í•˜ë©° ì´ë¥¼ ì°¾ì•„ë‚´ëŠ” ê²ƒì„ ì´ìƒ íƒì§€ ë¬¸ì œë¡œ ì •ì˜í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, í‰ì†Œ ë§Žì•„ë´¤ìž í•˜ë£¨ì— 10ê°œ ì •ë„ íŒ”ë¦¬ëŠ” ìƒí’ˆì´ ìžˆë‹¤ê³  ì³ë³´ì£ . ë­ê°€ ì¢‹ì„ê¹Œìš”? í–‡ë°˜ìœ¼ë¡œ í•©ì‹œë‹¤. ì œê°€ ì§€ê¸ˆ ì§‘ì— í–‡ë°˜ì´ ì—†ê±°ë“ ìš”. ðŸ˜¥ ê·¸ëŸ°ë° ë°ì´í„°ì— ê°‘ìžê¸° ì–´ë–¤ ì‚¬ëžŒì´ 10000ê°œë¥¼ í•œ ë²ˆì— êµ¬ë§¤í–ˆë‹¤ê³  ë‚˜ì™€ìžˆë‹¤ë©´ ì´ëŠ” ë‹¹ì—°ížˆ ë¹„ì •ìƒì ì¸ ë°ì´í„°ìž…ë‹ˆë‹¤. í–‡ë°˜ 10000ê°œë¥¼ ì‚¬ì„œ ì–´ë””ì— ë‹´ì•„ê°ˆ ìˆ˜ ìžˆì„ ê²ƒì´ë©°, ìž¬ê³ ëŠ” ìžˆì„ê¹Œìš”?  ì´ëŸ° ë°ì´í„°ëŠ” **outlier**ë¡œ ê°ì§€í•˜ê³  ê±¸ëŸ¬ë‚¼ ìˆ˜ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì´ ë•Œ ì“°ì´ëŠ” ë°©ë²•ì´ **ì´ìƒ íƒì§€**ìž…ë‹ˆë‹¤.

ì´ ê¸€ì—ì„œëŠ”, ê·¸ë¦¬ê³  ì œ ì—…ë¬´ì—ì„œëŠ” ì´ìƒ íƒì§€ ê¸°ë²•ìœ¼ë¡œ **Isolation Forest** ì„ ë‹¤ë¤„ë³´ë ¤ê³  í•©ë‹ˆë‹¤.



## Isolation Forest

ì§€ê¸ˆë¶€í„° ì´ìƒ íƒì§€ì˜ Model-based method ì¤‘ì˜ í•˜ë‚˜ì¸ **Isolation Forest**ì— ëŒ€í•´ í•¨ê»˜ ì•Œì•„ë´…ì‹œë‹¤.

### ê°œë…

**Isolation Forest**ëŠ” **ë¹„ì§€ë„ ì´ìƒ íƒì§€(Unsupervised Anomaly Detection)** ê¸°ë²• ì¤‘ í•˜ë‚˜ìž…ë‹ˆë‹¤. ì´ë¦„ì—ì„œ ë³¼ ìˆ˜ ìžˆë“¯ ì—¬ëŸ¬ ê°œì˜ **tree** ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìžˆê³  ëžœë¤ìœ¼ë¡œ ë°ì´í„°ë¥¼ **splití•˜ì—¬ ëª¨ë“  ë°ì´í„°ë¥¼ ê³ ë¦½(isolate)**ì‹œí‚¤ë©° outlierë¥¼ ì°¾ì•„ëƒ…ë‹ˆë‹¤. 

Isolation Forestì˜ ê¸°ë³¸ ì»¨ì…‰ì€ "**ì´ìƒì¹˜**ë¥¼ ê³ ë¦½(ë¶„ë¦¬)ì‹œí‚¤ëŠ” ê²ƒì´ ì •ìƒ ë°ì´í„°ë¥¼ ê³ ë¦½ì‹œí‚¤ëŠ” ê²ƒë³´ë‹¤ ì‰½ë‹¤"ëŠ” ê²ƒìž…ë‹ˆë‹¤. ì•„ëž˜ ê·¸ë¦¼ì„ ë³´ë©´ ì‰½ê²Œ ì´í•´ë  ê±°ì—ìš”.

![image](https://user-images.githubusercontent.com/51329156/112019412-c2765680-8b72-11eb-8723-8efac9e9681b.png)

**(1)**ì€ ì •ìƒ ë°ì´í„°ë¥¼ ê³ ë¦½ì‹œí‚¤ê¸° ìœ„í•´ ì´ 7ë²ˆì˜ splitì´ í•„ìš”í•˜ê³ ,

**(2)**ì˜ ê²½ìš°ëŠ” ì´ìƒì¹˜ë¥¼ ê³ ë¦½ì‹œí‚¤ê¸° ìœ„í•´ ì´ 3ë²ˆì˜ splitë§Œì´ í•„ìš”í•œ ê²ƒì„ ì•Œ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.



### í•™ìŠµ ë°©ë²•

íŠ¹ì • ê¸°ì¤€ì— ë”°ë¼ ë°ì´í„°ë¥¼ splití•˜ëŠ”ë°, ì •ìƒ ë°ì´í„°ì¼ìˆ˜ë¡ **terminal node**(leaf node)ì— ê°€ê¹ê³ , ê·¸ì— ë”°ë¼ ê²½ë¡œ ê¸¸ì´ê°€ ì»¤ì§‘ë‹ˆë‹¤. ì´ìƒì¹˜ëŠ” **root node**ì— ê°€ê¹ê³ , ê²½ë¡œ ê¸¸ì´ê°€ ì§§ìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/51329156/112020296-90b1bf80-8b73-11eb-8957-8fafcd5c5082.png)

**IForest** ëŠ” ì—¬ëŸ¬ê°œì˜ **ITree**ë¥¼ ì•™ìƒë¸”í•˜ì—¬ ë§Œë“¤ì–´ì§€ëŠ” êµ¬ì¡°ìž…ë‹ˆë‹¤.

**ITree**ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ê³„ë¥¼ ê±°ì³ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.

1. **Sub-sampling** : ë¹„ë³µì› ì¶”ì¶œë¡œ ë°ì´í„° ì¤‘ ì¼ë¶€ë¥¼ ìƒ˜í”Œë§
2. **ë³€ìˆ˜ ì„ íƒ** : ë°ì´í„° *X*ì˜ ë³€ìˆ˜ ì¤‘ *q*ë¥¼ ëžœë¤ ì„ íƒ
3. **split point ì„¤ì •** : ë³€ìˆ˜ *q*ì˜ ë²”ìœ„(max~min) ì¤‘ uniformí•˜ê²Œ split pointë¥¼ ì„ íƒ (ex. X > a ì´ë©´ True ì•„ë‹ˆë©´ False)
4. 1~3ë²ˆ ê³¼ì •ì„ ëª¨ë“  ê´€ì¸¡ì¹˜ê°€ split ë˜ê±°ë‚˜, ìž„ì˜ì˜ split íšŸìˆ˜ê¹Œì§€ ìž¬ê·€ì ìœ¼ë¡œ ë°˜ë³µ

ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ **ITree**ë¥¼ ì—¬ëŸ¬ë²ˆ ë°˜ë³µí•´ì„œ ìµœì¢…ì ìœ¼ë¡œ **IForest**ë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤. 

**ì°¸ê³ **

>ðŸš€ [Isolation Forest](https://velog.io/@vvakki_/Isolation-Forest-%EB%AF%B8%EC%99%84%EC%84%B1)

ì•„ëž˜ ê·¸ë¦¼ì€ ìœ„ì˜ ê³¼ì •ì„ ì‹¤ì œ **tree**ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒìž…ë‹ˆë‹¤. `X[0]` , `X[1]` ë“± ë³€ìˆ˜ë“¤ì„ ì‚¬ìš©í•´ True / Falseë¡œ êµ¬ë¶„í•˜ê³  ìžˆë„¤ìš”. 

![image](https://user-images.githubusercontent.com/51329156/112021880-18e49480-8b75-11eb-9773-def7446e813a.png)

ìœ„ì—ì„œ ë§í–ˆë˜ ì´ìƒì¹˜ëŠ” **root node**ì— ê°€ê¹ë‹¤ëŠ” ë§ì´ ë” ì™€ë‹¿ìœ¼ì‹¤ ê²ë‹ˆë‹¤. ë¹¨ë¦¬ **False**ë¡œ êµ¬ë¶„ë˜ì–´ì§ˆìˆ˜ë¡ rootì— ê°€ê¹ê²Œ ë˜ê³  ì´ëŸ° ë°ì´í„°ë¥¼ ì´ìƒì¹˜ë¡œ ì—¬ê¸°ëŠ” ê²ƒì´ì£ .

### ì‹œê°í™”

ì˜ˆ.. ì‹œê°í™”ë¥¼ í•˜ëŠ” ê²Œ ì‚¬ì‹¤ ê°€ìž¥ ì´í•´í•˜ê¸°ë„ ì‰½ê³  ì„¤ëª…í•˜ê¸°ë„ ì¢‹ì„í…ë° ê²€ì—´í•´ì•¼ í•  ë°ì´í„°ë„ ë§Žê³  í•´ì„œ ë§í¬ ë‚¨ê¸°ê² ìŠµë‹ˆë‹¤ ã…Žã…Ž..ðŸ˜‹ ì ˆëŒ€ ê·€ì°®ì•„ì„œ ê·¸ëŸ¬ëŠ” ê±° ì•„ë‹™ë‹ˆë‹¤!

ðŸš€ [Anomaly Detection with Isolation Forest & Visualization](https://towardsdatascience.com/anomaly-detection-with-isolation-forest-visualization-23cd75c281e2)

ðŸš€ [IsolationForest example](https://scikit-learn.org/stable/auto_examples/ensemble/plot_isolation_forest.html#sphx-glr-auto-examples-ensemble-plot-isolation-forest-py)

## Refrence

>ðŸš€ [ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ì˜ ì´ìƒ íƒì§€ (part 1)](https://medium.com/daria-blog/%EB%A8%B8%EC%8B%A0%EB%9F%AC%EB%8B%9D-%EA%B8%B0%EB%B0%98%EC%9D%98-%EC%9D%B4%EC%83%81-%ED%83%90%EC%A7%80-part-1-8d2fa0811059)
>
>ðŸš€ [Isolation Forest](https://velog.io/@vvakki_/Isolation-Forest-%EB%AF%B8%EC%99%84%EC%84%B1)
>
>ðŸš€ [Anomaly Detection with Isolation Forest & Visualization](https://towardsdatascience.com/anomaly-detection-with-isolation-forest-visualization-23cd75c281e2)
>
>ðŸš€ [IsolationForest example](https://scikit-learn.org/stable/auto_examples/ensemble/plot_isolation_forest.html#sphx-glr-auto-examples-ensemble-plot-isolation-forest-py)